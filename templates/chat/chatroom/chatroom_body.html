{% load static %}

<!-- START: Messages Section -->
<main id="chat-box" class="flex-1 overflow-y-auto p-4 space-y-2" style="margin-top: 55px; margin-bottom: 70px;">
{% for message in chat_messages reversed %}

<!-- Text Message -->
{% if message.type == 'text' %}

    {% if message.author == request.user %}
    <div class="flex items-start space-x-1 justify-end">
    {% else %}
    <div class="flex items-start space-x-1">
        <img src="https://via.placeholder.com/40" alt="User" class="w-8 h-8 rounded-full" />
    {% endif %}

        <div class="relative bg-slate-700 p-3 rounded-lg max-w-[60vw]">
        <div class="flex items-center justify-between">
            <p class="text-sm font-medium">{{ message.author }}</p>
            <span class="text-xs text-gray-400">{{ message.created_at|date:"h:i A" }}</span>
        </div>
        
        <p class="mt-1">{{ message.content }}</p>

        <!-- Hover Menu -->
        <div class="message-menu hidden absolute top-0 right-0 mt-1 mr-1 bg-gray-800 text-sm text-white rounded shadow-md">
            <button class="p-1">Reply</button>
            <button class="p-1">Edit</button>
            <button class="p-1">Delete</button>
        </div>

        </div>
    </div>
{% endif %}
<!-- ------------------------------------------------------------------------- -->

<!-- Sent Text Message -->
<!-- <div class="flex items-start space-x-1 justify-end">
    <div class="relative bg-slate-700 p-3 rounded-lg max-w-[60vw]">
    <div class="flex items-center justify-between">
        <p class="text-sm font-medium">You</p>
        <span class="text-xs text-gray-400">10:32 AM</span>
    </div>
    <p class="mt-1">I'm doing great! How about you? Don't you worry about me. How's grandma. Hope she's doing well also. ket me know</p>

    <!-- Hover Menu -->
    <!-- <div class="message-menu hidden absolute top-0 right-0 mt-1 mr-1 bg-gray-800 text-sm text-white rounded shadow-md">
        <button class="p-1">Reply</button>
        <button class="p-1">Edit</button>
        <button class="p-1">Delete</button>
    </div>
    </div>
</div>  -->

{% if message.type == 'image' %}
<!-- Received Image Message -->
<div class="flex items-start space-x-1">
    <img src="https://via.placeholder.com/40" alt="User" class="w-8 h-8 rounded-full" />
    <div class="relative bg-slate-700 p-3 rounded-lg max-w-[60vw]">
    <div class="flex items-center justify-between">
        <p class="text-sm font-medium">John Doe</p>
        <span class="text-xs text-gray-400">10:35 AM</span>
    </div>
    <img 
        src="https://via.placeholder.com/300"
        alt="Received Image" 
        class="mt-1 rounded-lg cursor-pointer" 
        onclick="viewMedia('https://via.placeholder.com/300')" 
    />

    <!-- Hover Menu -->
    <div class="message-menu hidden absolute top-0 right-0 mt-1 mr-1 bg-gray-800 text-sm text-white rounded shadow-md">
        <button class="p-1">Reply</button>
        <button class="p-1">Edit</button>
        <button class="p-1">Delete</button>
    </div>
    </div>
</div>
{% endif %}
<!-- ---------------------------------------------------------------------------------------- -->

{% if message.type == 'video' %}
<!-- Sent Video Message -->
<div class="flex items-start space-x-1 justify-end">
    <div class="relative bg-slate-700 p-3 rounded-lg max-w-[60vw]">
    <div class="flex items-center justify-between">
        <p class="text-sm font-medium">You</p>
        <span class="text-xs text-gray-400">10:40 AM</span>
    </div>
    <video 
        src="https://www.w3schools.com/html/mov_bbb.mp4" 
        controls 
        class="mt-1 rounded-lg cursor-pointer"
        onclick="viewMedia('https://www.w3schools.com/html/mov_bbb.mp4')"
    ></video>

    <!-- Hover Menu -->
    <div class="message-menu hidden absolute top-0 right-0 mt-1 mr-1 bg-gray-800 text-sm text-white rounded shadow-md">
        <button class="p-1">Reply</button>
        <button class="p-1">Edit</button>
        <button class="p-1">Delete</button>
    </div>
    </div>
</div>
{% endif %}
<!-- ---------------------------------------------------------------------------------------- -->

{% if message.type == 'file' %}
<!-- Received File Message -->
<div class="flex items-start space-x-1">
    <img src="https://via.placeholder.com/40" alt="User" class="w-8 h-8 rounded-full" />
    <div class="relative bg-slate-700 p-3 rounded-lg max-w-[60vw]">
    <div class="flex items-center justify-between">
        <p class="text-sm font-medium">John Doe</p>
        <span class="text-xs text-gray-400">10:45 AM</span>
    </div>
    <a href="C:\Users\anwar\Downloads\pdf\Jokes.pdf" download class="block bg-gray-800 text-white p-2 rounded-lg mt-1 underline">
        <img class="max-h-[30px] place-self-center" src="{% static 'chat/icons/download.png' %}" alt="Send" srcset="">
        Jokes by Anwar Hosen.pdf
    </a>

    <!-- Hover Menu -->
    <div class="message-menu hidden absolute top-0 right-0 mt-1 mr-1 bg-gray-800 text-sm text-white rounded shadow-md">
        <button class="p-1">Reply</button>
        <button class="p-1">Edit</button>
        <button class="p-1">Delete</button>
    </div>
    </div>
</div>
{% endif %}

{% endfor %}

<!-- Delivered Status (Centered) -->
<div class="flex justify-center mt-4">
    <span class="text-xs flex items-center space-x-1">
    <img src="{% static 'chat/icons/delivered.png' %}" alt="" class="w-5 h-5" />
    <span>Delivered</span>
    </span>
</div>

</main>
<!-- END: Messages Section -->

<!-- Floating Scroll Button -->
<button 
    id="scroll-down-btn" 
    class="hidden fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-slate-700 hover:bg-gray-600 text-white py-2 px-4 rounded-full shadow-lg focus:outline-none"
    onclick="scrollToBottom()"
>
    â†“ Scroll Down
</button>